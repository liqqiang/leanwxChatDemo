!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("webrtc",["exports","leancloud-realtime"],b):b(a.AV=a.AV||{},a.AV)}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a.default:a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},f=d(function(a){a.exports=function(){}}),g=d(function(a){a.exports=function(a,b){return{value:b,done:!!a}}}),h=d(function(a){a.exports={}}),i=d(function(a){var b={}.toString;a.exports=function(a){return b.call(a).slice(8,-1)}}),j=d(function(a){var b=i;a.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==b(a)?a.split(""):Object(a)}}),k=d(function(a){a.exports=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a}}),l=d(function(a){var b=j,c=k;a.exports=function(a){return b(c(a))}}),m=d(function(a){a.exports=!0}),n=d(function(a){var b=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=b)}),o=d(function(a){var b=a.exports={version:"2.4.0"};"number"==typeof __e&&(__e=b)}),p=d(function(a){a.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}}),q=d(function(a){var b=p;a.exports=function(a,c,d){if(b(a),void 0===c)return a;switch(d){case 1:return function(b){return a.call(c,b)};case 2:return function(b,d){return a.call(c,b,d)};case 3:return function(b,d,e){return a.call(c,b,d,e)}}return function(){return a.apply(c,arguments)}}}),r=d(function(a){a.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}}),s=d(function(a){var b=r;a.exports=function(a){if(!b(a))throw TypeError(a+" is not an object!");return a}}),t=d(function(a){a.exports=function(a){try{return!!a()}catch(a){return!0}}}),u=d(function(a){a.exports=!t(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})}),v=d(function(a){var b=r,c=n.document,d=b(c)&&b(c.createElement);a.exports=function(a){return d?c.createElement(a):{}}}),w=d(function(a){a.exports=!u&&!t(function(){return 7!=Object.defineProperty(v("div"),"a",{get:function(){return 7}}).a})}),x=d(function(a){var b=r;a.exports=function(a,c){if(!b(a))return a;var d,e;if(c&&"function"==typeof(d=a.toString)&&!b(e=d.call(a)))return e;if("function"==typeof(d=a.valueOf)&&!b(e=d.call(a)))return e;if(!c&&"function"==typeof(d=a.toString)&&!b(e=d.call(a)))return e;throw TypeError("Can't convert object to primitive value")}}),y=d(function(a,b){var c=s,d=w,e=x,f=Object.defineProperty;b.f=u?Object.defineProperty:function(a,b,g){if(c(a),b=e(b,!0),c(g),d)try{return f(a,b,g)}catch(a){}if("get"in g||"set"in g)throw TypeError("Accessors not supported!");return"value"in g&&(a[b]=g.value),a}}),z=d(function(a){a.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}}),A=d(function(a){var b=y,c=z;a.exports=u?function(a,d,e){return b.f(a,d,c(1,e))}:function(a,b,c){return a[b]=c,a}}),B=d(function(a){var b=n,c=o,d=q,e=A,f="prototype",g=function(a,h,i){var j,k,l,m=a&g.F,n=a&g.G,o=a&g.S,p=a&g.P,q=a&g.B,r=a&g.W,s=n?c:c[h]||(c[h]={}),t=s[f],u=n?b:o?b[h]:(b[h]||{})[f];n&&(i=h);for(j in i)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:i[j],s[j]=n&&"function"!=typeof u[j]?i[j]:q&&k?d(l,b):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[f]=a[f],b}(l):p&&"function"==typeof l?d(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&g.R&&t&&!t[j]&&e(t,j,l)))};g.F=1,g.G=2,g.S=4,g.P=8,g.B=16,g.W=32,g.U=64,g.R=128,a.exports=g}),C=d(function(a){a.exports=A}),D=d(function(a){var b={}.hasOwnProperty;a.exports=function(a,c){return b.call(a,c)}}),E=d(function(a){var b=Math.ceil,c=Math.floor;a.exports=function(a){return isNaN(a=+a)?0:(a>0?c:b)(a)}}),F=d(function(a){var b=E,c=Math.min;a.exports=function(a){return a>0?c(b(a),9007199254740991):0}}),G=d(function(a){var b=E,c=Math.max,d=Math.min;a.exports=function(a,e){return a=b(a),a<0?c(a+e,0):d(a,e)}}),H=d(function(a){var b=l,c=F,d=G;a.exports=function(a){return function(e,f,g){var h,i=b(e),j=c(i.length),k=d(g,j);if(a&&f!=f){for(;j>k;)if(h=i[k++],h!=h)return!0}else for(;j>k;k++)if((a||k in i)&&i[k]===f)return a||k||0;return!a&&-1}}}),I=d(function(a){var b=n,c="__core-js_shared__",d=b[c]||(b[c]={});a.exports=function(a){return d[a]||(d[a]={})}}),J=d(function(a){var b=0,c=Math.random();a.exports=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++b+c).toString(36))}}),K=d(function(a){var b=I("keys"),c=J;a.exports=function(a){return b[a]||(b[a]=c(a))}}),L=d(function(a){var b=D,c=l,d=H(!1),e=K("IE_PROTO");a.exports=function(a,f){var g,h=c(a),i=0,j=[];for(g in h)g!=e&&b(h,g)&&j.push(g);for(;f.length>i;)b(h,g=f[i++])&&(~d(j,g)||j.push(g));return j}}),M=d(function(a){a.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")}),N=d(function(a){var b=L,c=M;a.exports=Object.keys||function(a){return b(a,c)}}),O=d(function(a){var b=y,c=s,d=N;a.exports=u?Object.defineProperties:function(a,e){c(a);for(var f,g=d(e),h=g.length,i=0;h>i;)b.f(a,f=g[i++],e[f]);return a}}),P=d(function(a){a.exports=n.document&&document.documentElement}),Q=d(function(a){var b=s,c=O,d=M,e=K("IE_PROTO"),f=function(){},g="prototype",h=function(){var a,b=v("iframe"),c=d.length,e="<",f=">";for(b.style.display="none",P.appendChild(b),b.src="javascript:",a=b.contentWindow.document,a.open(),a.write(e+"script"+f+"document.F=Object"+e+"/script"+f),a.close(),h=a.F;c--;)delete h[g][d[c]];return h()};a.exports=Object.create||function(a,d){var i;return null!==a?(f[g]=b(a),i=new f,f[g]=null,i[e]=a):i=h(),void 0===d?i:c(i,d)}}),R=d(function(a){var b=I("wks"),c=J,d=n.Symbol,e="function"==typeof d,f=a.exports=function(a){return b[a]||(b[a]=e&&d[a]||(e?d:c)("Symbol."+a))};f.store=b}),S=d(function(a){var b=y.f,c=D,d=R("toStringTag");a.exports=function(a,e,f){a&&!c(a=f?a:a.prototype,d)&&b(a,d,{configurable:!0,value:e})}}),T=d(function(a){var b=Q,c=z,d=S,e={};A(e,R("iterator"),function(){return this}),a.exports=function(a,f,g){a.prototype=b(e,{next:c(1,g)}),d(a,f+" Iterator")}}),U=d(function(a){var b=k;a.exports=function(a){return Object(b(a))}}),V=d(function(a){var b=D,c=U,d=K("IE_PROTO"),e=Object.prototype;a.exports=Object.getPrototypeOf||function(a){return a=c(a),b(a,d)?a[d]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?e:null}}),W=d(function(a){var b=m,c=B,d=C,e=A,f=D,g=h,i=T,j=S,k=V,l=R("iterator"),n=!([].keys&&"next"in[].keys()),o="@@iterator",p="keys",q="values",r=function(){return this};a.exports=function(a,h,m,s,t,u,v){i(m,h,s);var w,x,y,z=function(a){if(!n&&a in D)return D[a];switch(a){case p:return function(){return new m(this,a)};case q:return function(){return new m(this,a)}}return function(){return new m(this,a)}},A=h+" Iterator",B=t==q,C=!1,D=a.prototype,E=D[l]||D[o]||t&&D[t],F=E||z(t),G=t?B?z("entries"):F:void 0,H="Array"==h?D.entries||E:E;if(H&&(y=k(H.call(new a)),y!==Object.prototype&&(j(y,A,!0),b||f(y,l)||e(y,l,r))),B&&E&&E.name!==q&&(C=!0,F=function(){return E.call(this)}),b&&!v||!n&&!C&&D[l]||e(D,l,F),g[h]=F,g[A]=r,t)if(w={values:B?F:z(q),keys:u?F:z(p),entries:G},v)for(x in w)x in D||d(D,x,w[x]);else c(c.P+c.F*(n||C),h,w);return w}}),X=(d(function(a){var b=f,c=g,d=h,e=l;a.exports=W(Array,"Array",function(a,b){this._t=e(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,d=this._i++;return!a||d>=a.length?(this._t=void 0,c(1)):"keys"==b?c(0,d):"values"==b?c(0,a[d]):c(0,[d,a[d]])},"values"),d.Arguments=d.Array,b("keys"),b("values"),b("entries")}),d(function(a){for(var b=n,c=A,d=h,e=R("toStringTag"),f=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],g=0;g<5;g++){var i=f[g],j=b[i],k=j&&j.prototype;k&&!k[e]&&c(k,e,i),d[i]=d.Array}}),d(function(a){var b=E,c=k;a.exports=function(a){return function(d,e){var f,g,h=String(c(d)),i=b(e),j=h.length;return i<0||i>=j?a?"":void 0:(f=h.charCodeAt(i),f<55296||f>56319||i+1===j||(g=h.charCodeAt(i+1))<56320||g>57343?a?h.charAt(i):f:a?h.slice(i,i+2):(f-55296<<10)+(g-56320)+65536)}}})),Y=(d(function(a){var b=X(!0);W(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,c=this._t,d=this._i;return d>=c.length?{value:void 0,done:!0}:(a=b(c,d),this._i+=a.length,{value:a,done:!1})})}),d(function(a){var b=i,c=R("toStringTag"),d="Arguments"==b(function(){return arguments}()),e=function(a,b){try{return a[b]}catch(a){}};a.exports=function(a){var f,g,h;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(g=e(f=Object(a),c))?g:d?b(f):"Object"==(h=b(f))&&"function"==typeof f.callee?"Arguments":h}})),Z=d(function(a){var b=Y,c=R("iterator"),d=h;a.exports=o.isIterable=function(a){var e=Object(a);return void 0!==e[c]||"@@iterator"in e||d.hasOwnProperty(b(e))}}),$=d(function(a){a.exports=Z}),_=d(function(a){a.exports={default:$,__esModule:!0}}),aa=d(function(a){var b=Y,c=R("iterator"),d=h;a.exports=o.getIteratorMethod=function(a){if(void 0!=a)return a[c]||a["@@iterator"]||d[b(a)]}}),ba=d(function(a){var b=s,c=aa;a.exports=o.getIterator=function(a){var d=c(a);if("function"!=typeof d)throw TypeError(a+" is not iterable!");return b(d.call(a))}}),ca=d(function(a){a.exports=ba}),da=d(function(a){a.exports={default:ca,__esModule:!0}}),ea=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=_,e=c(d),f=da,g=c(f);b.default=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var h,i=(0,g.default)(a);!(d=(h=i.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&i.return&&i.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if((0,e.default)(Object(b)))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}),fa=c(ea),ga=d(function(a){a.exports=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a}}),ha=d(function(a){var b=s;a.exports=function(a,c,d,e){try{return e?c(b(d)[0],d[1]):c(d)}catch(c){var f=a.return;throw void 0!==f&&b(f.call(a)),c}}}),ia=d(function(a){var b=h,c=R("iterator"),d=Array.prototype;a.exports=function(a){return void 0!==a&&(b.Array===a||d[c]===a)}}),ja=d(function(a){var b=q,c=ha,d=ia,e=s,f=F,g=aa,h={},i={},j=a.exports=function(a,j,k,l,m){var n,o,p,q,r=m?function(){return a}:g(a),s=b(k,l,j?2:1),t=0;if("function"!=typeof r)throw TypeError(a+" is not iterable!");if(d(r)){for(n=f(a.length);n>t;t++)if(q=j?s(e(o=a[t])[0],o[1]):s(a[t]),q===h||q===i)return q}else for(p=r.call(a);!(o=p.next()).done;)if(q=c(p,s,o.value,j),q===h||q===i)return q};j.BREAK=h,j.RETURN=i}),ka=d(function(a){var b=s,c=p,d=R("species");a.exports=function(a,e){var f,g=b(a).constructor;return void 0===g||void 0==(f=b(g)[d])?e:c(f)}}),la=d(function(a){a.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}}),ma=d(function(a){var b,c,d,e=q,f=la,g=P,h=v,j=n,k=j.process,l=j.setImmediate,m=j.clearImmediate,o=j.MessageChannel,p=0,r={},s="onreadystatechange",t=function(){var a=+this;if(r.hasOwnProperty(a)){var b=r[a];delete r[a],b()}},u=function(a){t.call(a.data)};l&&m||(l=function(a){for(var c=[],d=1;arguments.length>d;)c.push(arguments[d++]);return r[++p]=function(){f("function"==typeof a?a:Function(a),c)},b(p),p},m=function(a){delete r[a]},"process"==i(k)?b=function(a){k.nextTick(e(t,a,1))}:o?(c=new o,d=c.port2,c.port1.onmessage=u,b=e(d.postMessage,d,1)):j.addEventListener&&"function"==typeof postMessage&&!j.importScripts?(b=function(a){j.postMessage(a+"","*")},j.addEventListener("message",u,!1)):b=s in h("script")?function(a){g.appendChild(h("script"))[s]=function(){g.removeChild(this),t.call(a)}}:function(a){setTimeout(e(t,a,1),0)}),a.exports={set:l,clear:m}}),na=d(function(a){var b=n,c=ma.set,d=b.MutationObserver||b.WebKitMutationObserver,e=b.process,f=b.Promise,g="process"==i(e);a.exports=function(){var a,h,i,j=function(){var b,c;for(g&&(b=e.domain)&&b.exit();a;){c=a.fn,a=a.next;try{c()}catch(b){throw a?i():h=void 0,b}}h=void 0,b&&b.enter()};if(g)i=function(){e.nextTick(j)};else if(d){var k=!0,l=document.createTextNode("");new d(j).observe(l,{characterData:!0}),i=function(){l.data=k=!k}}else if(f&&f.resolve){var m=f.resolve();i=function(){m.then(j)}}else i=function(){c.call(b,j)};return function(b){var c={fn:b,next:void 0};h&&(h.next=c),a||(a=c,i()),h=c}}}),oa=d(function(a){var b=A;a.exports=function(a,c,d){for(var e in c)d&&a[e]?a[e]=c[e]:b(a,e,c[e]);return a}}),pa=d(function(a){var b=n,c=o,d=y,e=u,f=R("species");a.exports=function(a){var g="function"==typeof c[a]?c[a]:b[a];e&&g&&!g[f]&&d.f(g,f,{configurable:!0,get:function(){return this}})}}),qa=d(function(a){var b=R("iterator"),c=!1;try{var d=[7][b]();d.return=function(){c=!0},Array.from(d,function(){throw 2})}catch(a){}a.exports=function(a,d){if(!d&&!c)return!1;var e=!1;try{var f=[7],g=f[b]();g.next=function(){return{done:e=!0}},f[b]=function(){return g},a(f)}catch(a){}return e}}),ra=(d(function(a){var b,c,d,e=m,f=n,g=q,h=Y,i=B,j=r,k=p,l=ga,s=ja,t=ka,u=ma.set,v=na(),w="Promise",x=f.TypeError,y=f.process,z=f[w],y=f.process,A="process"==h(y),C=function(){},D=!!function(){try{var a=z.resolve(1),b=(a.constructor={})[R("species")]=function(a){a(C,C)};return(A||"function"==typeof PromiseRejectionEvent)&&a.then(C)instanceof b}catch(a){}}(),E=function(a,b){return a===b||a===z&&b===d},F=function(a){var b;return!(!j(a)||"function"!=typeof(b=a.then))&&b},G=function(a){return E(z,a)?new H(a):new c(a)},H=c=function(a){var b,c;this.promise=new a(function(a,d){if(void 0!==b||void 0!==c)throw x("Bad Promise constructor");b=a,c=d}),this.resolve=k(b),this.reject=k(c)},I=function(a){try{a()}catch(a){return{error:a}}},J=function(a,b){if(!a._n){a._n=!0;var c=a._c;v(function(){for(var d=a._v,e=1==a._s,f=0,g=function(b){var c,f,g=e?b.ok:b.fail,h=b.resolve,i=b.reject,j=b.domain;try{g?(e||(2==a._h&&M(a),a._h=1),g===!0?c=d:(j&&j.enter(),c=g(d),j&&j.exit()),c===b.promise?i(x("Promise-chain cycle")):(f=F(c))?f.call(c,h,i):h(c)):i(d)}catch(a){i(a)}};c.length>f;)g(c[f++]);a._c=[],a._n=!1,b&&!a._h&&K(a)})}},K=function(a){u.call(f,function(){var b,c,d,e=a._v;if(L(a)&&(b=I(function(){A?y.emit("unhandledRejection",e,a):(c=f.onunhandledrejection)?c({promise:a,reason:e}):(d=f.console)&&d.error&&d.error("Unhandled promise rejection",e)}),a._h=A||L(a)?2:1),a._a=void 0,b)throw b.error})},L=function(a){if(1==a._h)return!1;for(var b,c=a._a||a._c,d=0;c.length>d;)if(b=c[d++],b.fail||!L(b.promise))return!1;return!0},M=function(a){u.call(f,function(){var b;A?y.emit("rejectionHandled",a):(b=f.onrejectionhandled)&&b({promise:a,reason:a._v})})},N=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),J(b,!0))},O=function(a){var b,c=this;if(!c._d){c._d=!0,c=c._w||c;try{if(c===a)throw x("Promise can't be resolved itself");(b=F(a))?v(function(){var d={_w:c,_d:!1};try{b.call(a,g(O,d,1),g(N,d,1))}catch(a){N.call(d,a)}}):(c._v=a,c._s=1,J(c,!1))}catch(a){N.call({_w:c,_d:!1},a)}}};D||(z=function(a){l(this,z,w,"_h"),k(a),b.call(this);try{a(g(O,this,1),g(N,this,1))}catch(a){N.call(this,a)}},b=function(a){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},b.prototype=oa(z.prototype,{then:function(a,b){var c=G(t(this,z));return c.ok="function"!=typeof a||a,c.fail="function"==typeof b&&b,c.domain=A?y.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&J(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),H=function(){var a=new b;this.promise=a,this.resolve=g(O,a,1),this.reject=g(N,a,1)}),i(i.G+i.W+i.F*!D,{Promise:z}),S(z,w),pa(w),d=o[w],i(i.S+i.F*!D,w,{reject:function(a){var b=G(this),c=b.reject;return c(a),b.promise}}),i(i.S+i.F*(e||!D),w,{resolve:function(a){if(a instanceof z&&E(a.constructor,this))return a;var b=G(this),c=b.resolve;return c(a),b.promise}}),i(i.S+i.F*!(D&&qa(function(a){z.all(a).catch(C)})),w,{all:function(a){var b=this,c=G(b),d=c.resolve,e=c.reject,f=I(function(){var c=[],f=0,g=1;s(a,!1,function(a){var h=f++,i=!1;c.push(void 0),g++,b.resolve(a).then(function(a){i||(i=!0,c[h]=a,--g||d(c))},e)}),--g||d(c)});return f&&e(f.error),c.promise},race:function(a){var b=this,c=G(b),d=c.reject,e=I(function(){s(a,!1,function(a){b.resolve(a).then(c.resolve,d)})});return e&&d(e.error),c.promise}})}),d(function(a){a.exports=o.Promise})),sa=d(function(a){a.exports={default:ra,__esModule:!0}}),ta=c(sa),ua=d(function(a,b){b.f=Object.getOwnPropertySymbols}),va=d(function(a,b){b.f={}.propertyIsEnumerable}),wa=d(function(a){var b=N,c=ua,d=va,e=U,f=j,g=Object.assign;a.exports=!g||t(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=g({},a)[c]||Object.keys(g({},b)).join("")!=d})?function(a,g){for(var h=e(a),i=arguments.length,j=1,k=c.f,l=d.f;i>j;)for(var m,n=f(arguments[j++]),o=k?b(n).concat(k(n)):b(n),p=o.length,q=0;p>q;)l.call(n,m=o[q++])&&(h[m]=n[m]);return h}:g}),xa=(d(function(a){var b=B;b(b.S+b.F,"Object",{assign:wa})}),d(function(a){a.exports=o.Object.assign})),ya=d(function(a){a.exports={default:xa,__esModule:!0}}),za=c(ya),Aa=d(function(a,b){b.__esModule=!0,b.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}}),Ba=c(Aa),Ca=d(function(a,b){b.f=R}),Da=d(function(a){a.exports=Ca.f("iterator")}),Ea=d(function(a){a.exports={default:Da,__esModule:!0}}),Fa=d(function(a){var b=J("meta"),c=r,d=D,e=y.f,f=0,g=Object.isExtensible||function(){return!0},h=!t(function(){return g(Object.preventExtensions({}))}),i=function(a){e(a,b,{value:{i:"O"+ ++f,w:{}}})},j=function(a,e){if(!c(a))return"symbol"==typeof a?a:("string"==typeof a?"S":"P")+a;if(!d(a,b)){if(!g(a))return"F";if(!e)return"E";i(a)}return a[b].i},k=function(a,c){if(!d(a,b)){if(!g(a))return!0;if(!c)return!1;i(a)}return a[b].w},l=function(a){return h&&m.NEED&&g(a)&&!d(a,b)&&i(a),a},m=a.exports={KEY:b,NEED:!1,fastKey:j,getWeak:k,onFreeze:l}}),Ga=d(function(a){var b=n,c=o,d=m,e=Ca,f=y.f;a.exports=function(a){var g=c.Symbol||(c.Symbol=d?{}:b.Symbol||{});"_"==a.charAt(0)||a in g||f(g,a,{value:e.f(a)})}}),Ha=d(function(a){var b=N,c=l;a.exports=function(a,d){for(var e,f=c(a),g=b(f),h=g.length,i=0;h>i;)if(f[e=g[i++]]===d)return e}}),Ia=d(function(a){var b=N,c=ua,d=va;a.exports=function(a){var e=b(a),f=c.f;if(f)for(var g,h=f(a),i=d.f,j=0;h.length>j;)i.call(a,g=h[j++])&&e.push(g);return e}}),Ja=d(function(a){var b=i;a.exports=Array.isArray||function(a){return"Array"==b(a)}}),Ka=d(function(a,b){var c=L,d=M.concat("length","prototype");b.f=Object.getOwnPropertyNames||function(a){return c(a,d)}}),La=d(function(a){var b=l,c=Ka.f,d={}.toString,e="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],f=function(a){try{return c(a)}catch(a){return e.slice()}};a.exports.f=function(a){return e&&"[object Window]"==d.call(a)?f(a):c(b(a))}}),Ma=d(function(a,b){var c=va,d=z,e=l,f=x,g=D,h=w,i=Object.getOwnPropertyDescriptor;b.f=u?i:function(a,b){if(a=e(a),b=f(b,!0),h)try{return i(a,b)}catch(a){}if(g(a,b))return d(!c.f.call(a,b),a[b])}}),Na=(d(function(a){var b=n,c=D,d=u,e=B,f=C,g=Fa.KEY,h=t,i=I,j=S,k=J,o=R,p=Ca,q=Ga,r=Ha,v=Ia,w=Ja,E=s,F=l,G=x,H=z,K=Q,L=La,M=Ma,O=y,P=N,T=M.f,U=O.f,V=L.f,W=b.Symbol,X=b.JSON,Y=X&&X.stringify,Z="prototype",$=o("_hidden"),_=o("toPrimitive"),aa={}.propertyIsEnumerable,ba=i("symbol-registry"),ca=i("symbols"),da=i("op-symbols"),ea=Object[Z],fa="function"==typeof W,ga=b.QObject,ha=!ga||!ga[Z]||!ga[Z].findChild,ia=d&&h(function(){return 7!=K(U({},"a",{get:function(){return U(this,"a",{value:7}).a}})).a})?function(a,b,c){var d=T(ea,b);d&&delete ea[b],U(a,b,c),d&&a!==ea&&U(ea,b,d)}:U,ja=function(a){var b=ca[a]=K(W[Z]);return b._k=a,b},ka=fa&&"symbol"==typeof W.iterator?function(a){return"symbol"==typeof a}:function(a){return a instanceof W},la=function(a,b,d){return a===ea&&la(da,b,d),E(a),b=G(b,!0),E(d),c(ca,b)?(d.enumerable?(c(a,$)&&a[$][b]&&(a[$][b]=!1),d=K(d,{enumerable:H(0,!1)})):(c(a,$)||U(a,$,H(1,{})),a[$][b]=!0),ia(a,b,d)):U(a,b,d)},ma=function(a,b){E(a);for(var c,d=v(b=F(b)),e=0,f=d.length;f>e;)la(a,c=d[e++],b[c]);return a},na=function(a,b){return void 0===b?K(a):ma(K(a),b)},oa=function(a){var b=aa.call(this,a=G(a,!0));return!(this===ea&&c(ca,a)&&!c(da,a))&&(!(b||!c(this,a)||!c(ca,a)||c(this,$)&&this[$][a])||b)},pa=function(a,b){if(a=F(a),b=G(b,!0),a!==ea||!c(ca,b)||c(da,b)){var d=T(a,b);return!d||!c(ca,b)||c(a,$)&&a[$][b]||(d.enumerable=!0),d}},qa=function(a){for(var b,d=V(F(a)),e=[],f=0;d.length>f;)c(ca,b=d[f++])||b==$||b==g||e.push(b);return e},ra=function(a){for(var b,d=a===ea,e=V(d?da:F(a)),f=[],g=0;e.length>g;)!c(ca,b=e[g++])||d&&!c(ea,b)||f.push(ca[b]);return f};fa||(W=function(){if(this instanceof W)throw TypeError("Symbol is not a constructor!");var a=k(arguments.length>0?arguments[0]:void 0),b=function(d){this===ea&&b.call(da,d),c(this,$)&&c(this[$],a)&&(this[$][a]=!1),ia(this,a,H(1,d))};return d&&ha&&ia(ea,a,{configurable:!0,set:b}),ja(a)},f(W[Z],"toString",function(){return this._k}),M.f=pa,O.f=la,Ka.f=L.f=qa,va.f=oa,ua.f=ra,d&&!m&&f(ea,"propertyIsEnumerable",oa,!0),p.f=function(a){return ja(o(a))}),e(e.G+e.W+e.F*!fa,{Symbol:W});for(var sa="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ta=0;sa.length>ta;)o(sa[ta++]);for(var sa=P(o.store),ta=0;sa.length>ta;)q(sa[ta++]);e(e.S+e.F*!fa,"Symbol",{for:function(a){return c(ba,a+="")?ba[a]:ba[a]=W(a)},keyFor:function(a){if(ka(a))return r(ba,a);throw TypeError(a+" is not a symbol!")},useSetter:function(){ha=!0},useSimple:function(){ha=!1}}),e(e.S+e.F*!fa,"Object",{create:na,defineProperty:la,defineProperties:ma,getOwnPropertyDescriptor:pa,getOwnPropertyNames:qa,getOwnPropertySymbols:ra}),X&&e(e.S+e.F*(!fa||h(function(){var a=W();return"[null]"!=Y([a])||"{}"!=Y({a:a})||"{}"!=Y(Object(a))})),"JSON",{stringify:function(a){if(void 0!==a&&!ka(a)){for(var b,c,d=[a],e=1;arguments.length>e;)d.push(arguments[e++]);return b=d[1],"function"==typeof b&&(c=b),!c&&w(b)||(b=function(a,b){if(c&&(b=c.call(this,a,b)),!ka(b))return b}),d[1]=b,Y.apply(X,d)}}}),W[Z][_]||A(W[Z],_,W[Z].valueOf),j(W,"Symbol"),j(Math,"Math",!0),j(b.JSON,"JSON",!0)}),d(function(a){Ga("asyncIterator")}),d(function(a){Ga("observable")}),d(function(a){a.exports=o.Symbol})),Oa=d(function(a){a.exports={default:Na,__esModule:!0}}),Pa=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=Ea,e=c(d),f=Oa,g=c(f),h="function"==typeof g.default&&"symbol"==typeof e.default?function(a){return typeof a}:function(a){return a&&"function"==typeof g.default&&a.constructor===g.default&&a!==g.default.prototype?"symbol":typeof a};b.default="function"==typeof g.default&&"symbol"===h(e.default)?function(a){return"undefined"==typeof a?"undefined":h(a)}:function(a){return a&&"function"==typeof g.default&&a.constructor===g.default&&a!==g.default.prototype?"symbol":"undefined"==typeof a?"undefined":h(a)}}),Qa=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=Pa,e=c(d);b.default=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==("undefined"==typeof b?"undefined":(0,e.default)(b))&&"function"!=typeof b?a:b}}),Ra=c(Qa),Sa=d(function(a){var b=r,c=s,d=function(a,d){if(c(a),!b(d)&&null!==d)throw TypeError(d+": can't set as prototype!")};a.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(a,b,c){try{c=q(Function.call,Ma.f(Object.prototype,"__proto__").set,2),c(a,[]),b=!(a instanceof Array)}catch(a){b=!0}return function(a,e){return d(a,e),b?a.__proto__=e:c(a,e),a}}({},!1):void 0),check:d}}),Ta=(d(function(a){var b=B;b(b.S,"Object",{setPrototypeOf:Sa.set})}),d(function(a){a.exports=o.Object.setPrototypeOf})),Ua=d(function(a){a.exports={default:Ta,__esModule:!0}}),Va=(d(function(a){var b=B;b(b.S,"Object",{create:Q})}),d(function(a){var b=o.Object;a.exports=function(a,c){return b.create(a,c)}})),Wa=d(function(a){a.exports={default:Va,__esModule:!0}}),Xa=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=Ua,e=c(d),f=Wa,g=c(f),h=Pa,i=c(h);b.default=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof b?"undefined":(0,i.default)(b)));a.prototype=(0,g.default)(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(e.default?(0,e.default)(a,b):a.__proto__=b)}}),Ya=c(Xa),Za=d(function(a){function b(){}function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function d(){this._events=new b,this._eventsCount=0}var e=Object.prototype.hasOwnProperty,f="~";Object.create&&(b.prototype=Object.create(null),(new b).__proto__||(f=!1)),d.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)e.call(a,b)&&c.push(f?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},d.prototype.listeners=function(a,b){var c=f?f+a:a,d=this._events[c];if(b)return!!d;if(!d)return[];if(d.fn)return[d.fn];for(var e=0,g=d.length,h=new Array(g);e<g;e++)h[e]=d[e].fn;return h},d.prototype.emit=function(a,b,c,d,e,g){var h=f?f+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,e),!0;case 6:return k.fn.call(k.context,b,c,d,e,g),!0}for(j=1,i=new Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=new Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},d.prototype.on=function(a,b,d){var e=new c(b,d||this),g=f?f+a:a;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],e]:this._events[g].push(e):(this._events[g]=e,this._eventsCount++),this},d.prototype.once=function(a,b,d){var e=new c(b,d||this,!0),g=f?f+a:a;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],e]:this._events[g].push(e):(this._events[g]=e,this._eventsCount++),this},d.prototype.removeListener=function(a,c,d,e){var g=f?f+a:a;if(!this._events[g])return this;if(!c)return 0===--this._eventsCount?this._events=new b:delete this._events[g],this;var h=this._events[g];if(h.fn)h.fn!==c||e&&!h.once||d&&h.context!==d||(0===--this._eventsCount?this._events=new b:delete this._events[g]);else{for(var i=0,j=[],k=h.length;i<k;i++)(h[i].fn!==c||e&&!h[i].once||d&&h[i].context!==d)&&j.push(h[i]);j.length?this._events[g]=1===j.length?j[0]:j:0===--this._eventsCount?this._events=new b:delete this._events[g]}return this},d.prototype.removeAllListeners=function(a){var c;return a?(c=f?f+a:a,this._events[c]&&(0===--this._eventsCount?this._events=new b:delete this._events[c])):(this._events=new b,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prototype.setMaxListeners=function(){return this},d.prefixed=f,d.EventEmitter=d,"undefined"!=typeof a&&(a.exports=d)}),$a=(d(function(a){var b=B;b(b.S+b.F*!u,"Object",{defineProperty:y.f})}),d(function(a){var b=o.Object;a.exports=function(a,c,d){return b.defineProperty(a,c,d)}})),_a=d(function(a){a.exports={default:$a,__esModule:!0}}),ab=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=_a,e=c(d);b.default=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),(0,e.default)(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()}),bb=c(ab),cb=d(function(a,b){!function(){var c={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,b){var d="string"==typeof a.initial?{state:a.initial}:a.initial,e=a.terminal||a.final,f=b||a.target||{},g=a.events||[],h=a.callbacks||{},i={},j={},k=function(a){var b=Array.isArray(a.from)?a.from:a.from?[a.from]:[c.WILDCARD];i[a.name]=i[a.name]||{};for(var d=0;d<b.length;d++)j[b[d]]=j[b[d]]||[],j[b[d]].push(a.name),i[a.name][b[d]]=a.to||b[d];a.to&&(j[a.to]=j[a.to]||[])};d&&(d.event=d.event||"startup",k({name:d.event,from:"none",to:d.state}));for(var l=0;l<g.length;l++)k(g[l]);for(var m in i)i.hasOwnProperty(m)&&(f[m]=c.buildEvent(m,i[m]));for(var m in h)h.hasOwnProperty(m)&&(f[m]=h[m]);return f.current="none",f.is=function(a){return Array.isArray(a)?a.indexOf(this.current)>=0:this.current===a},f.can=function(a){return!this.transition&&void 0!==i[a]&&(i[a].hasOwnProperty(this.current)||i[a].hasOwnProperty(c.WILDCARD))},f.cannot=function(a){return!this.can(a)},f.transitions=function(){return(j[this.current]||[]).concat(j[c.WILDCARD]||[])},f.isFinished=function(){return this.is(e)},f.error=a.error||function(a,b,c,d,e,f,g){throw g||f},f.states=function(){return Object.keys(j).sort()},d&&!d.defer&&f[d.event](),f},doCallback:function(a,b,d,e,f,g){if(b)try{return b.apply(a,[d,e,f].concat(g))}catch(b){return a.error(d,e,f,g,c.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",b)}},beforeAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onbeforeevent,b,d,e,f)},afterAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onafterevent||a.onevent,b,d,e,f)},leaveAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onleavestate,b,d,e,f)},enterAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onenterstate||a.onstate,b,d,e,f)},changeState:function(a,b,d,e,f){return c.doCallback(a,a.onchangestate,b,d,e,f)},beforeThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onbefore"+b],b,d,e,f)},afterThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onafter"+b]||a["on"+b],b,d,e,f)},leaveThisState:function(a,b,d,e,f){return c.doCallback(a,a["onleave"+d],b,d,e,f)},enterThisState:function(a,b,d,e,f){return c.doCallback(a,a["onenter"+e]||a["on"+e],b,d,e,f)},beforeEvent:function(a,b,d,e,f){if(!1===c.beforeThisEvent(a,b,d,e,f)||!1===c.beforeAnyEvent(a,b,d,e,f))return!1},afterEvent:function(a,b,d,e,f){c.afterThisEvent(a,b,d,e,f),c.afterAnyEvent(a,b,d,e,f)},leaveState:function(a,b,d,e,f){var g=c.leaveThisState(a,b,d,e,f),h=c.leaveAnyState(a,b,d,e,f);return!1!==g&&!1!==h&&(c.ASYNC===g||c.ASYNC===h?c.ASYNC:void 0)},enterState:function(a,b,d,e,f){c.enterThisState(a,b,d,e,f),c.enterAnyState(a,b,d,e,f)},buildEvent:function(a,b){return function(){var d=this.current,e=b[d]||(b[c.WILDCARD]!=c.WILDCARD?b[c.WILDCARD]:d)||d,f=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,d,e,f,c.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,d,e,f,c.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===c.beforeEvent(this,a,d,e,f))return c.Result.CANCELLED;if(d===e)return c.afterEvent(this,a,d,e,f),c.Result.NOTRANSITION;var g=this;this.transition=function(){return g.transition=null,g.current=e,
c.enterState(g,a,d,e,f),c.changeState(g,a,d,e,f),c.afterEvent(g,a,d,e,f),c.Result.SUCCEEDED},this.transition.cancel=function(){g.transition=null,c.afterEvent(g,a,d,e,f)};var h=c.leaveState(this,a,d,e,f);return!1===h?(this.transition=null,c.Result.CANCELLED):c.ASYNC===h?c.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof b?("undefined"!=typeof a&&a.exports&&(b=a.exports=c),b.StateMachine=c):"function"==typeof define&&define.amd?define(function(a){return c}):"undefined"!=typeof window?window.StateMachine=c:"undefined"!=typeof self&&(self.StateMachine=c)}()}),db=function(){return cb.create({initial:"calling",events:[{name:"connect",from:"calling",to:"connected"},{name:"close",from:"connected",to:"closed"},{name:"cancel",from:"calling",to:"canceled"},{name:"refuse",from:"calling",to:"refused"}]})},eb=d(function(a,b){!function(c){function d(a){var b=l(a);if(r)for(var c,d=0;c=u[d++];)a.hasOwnProperty(c)&&b.push(c);return b}function e(a,b,c){for(var e,f,g=d(c),i=0,j=g.length;i<j;)"__self"!==(e=g[i++])&&(f=c[e],!p(f)||f.prototype&&f.prototype.__self||h&&!(f.toString().indexOf(".__base")>-1)?b[e]=f:b[e]=function(c,d){var e=a[c]?a[c]:"__constructor"===c?b.__self.__parent:q,f=function(){var a=this.__base;this.__base=f.__base;var b=d.apply(this,arguments);return this.__base=a,b};return f.__base=e,f}(e,f))}function f(a,b){for(var c,d=1;c=a[d++];)b?p(c)?g.self(b,c.prototype,c):g.self(b,c):b=p(c)?g(a[0],c.prototype,c):g(a[0],c);return b||a[0]}function g(){var a=arguments,b=o(a[0]),c=b||p(a[0]),d=c?b?f(a[0]):a[0]:i,g=a[c?1:0]||{},h=a[c?2:1],j=g.__constructor||c&&d.prototype&&d.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:c?function(){return d.apply(this,arguments)}:function(){};if(!c)return j.prototype=g,j.prototype.__self=j.prototype.constructor=j,m(j,h);m(j,d),j.__parent=d;var l=d.prototype,n=j.prototype=k(l);return n.__self=n.constructor=j,g&&e(l,n,g),h&&e(d,j,h),j}var h=function(){return"_"}.toString().indexOf("_")>-1,i=function(){},j=Object.prototype.hasOwnProperty,k=Object.create||function(a){var b=function(){};return b.prototype=a,new b},l=Object.keys||function(a){var b=[];for(var c in a)j.call(a,c)&&b.push(c);return b},m=function(a,b){for(var c in b)j.call(b,c)&&(a[c]=b[c]);return a},n=Object.prototype.toString,o=Array.isArray||function(a){return"[object Array]"===n.call(a)},p=function(a){return"[object Function]"===n.call(a)},q=function(){},r=!0,s={toString:""};for(var t in s)s.hasOwnProperty(t)&&(r=!1);var u=r?["toString","valueOf"]:null;g.self=function(){var a=arguments,b=o(a[0]),c=b?f(a[0],a[0][0]):a[0],d=a[1],g=a[2],h=c.prototype;return d&&e(h,h,d),g&&e(c,c,g),c};var v=!0;"object"==typeof b&&(a.exports=g,v=!1),"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(a){a(g)}),v=!1),"function"==typeof define&&(define(function(a,b,c){c.exports=g}),v=!1),v&&(c.inherit=g)}(e)}),fb=d(function(a){a.exports=eb});if(!b.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var gb=fb(b.TypedMessage,{__constructor:function(a){this.__base(),this.payload=a,this.setTransient(!0)}});b.messageField("payload")(gb);var hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb=(hb=b.messageType(-102),hb(ib=function(a){function b(){return Ba(this,b),Ra(this,a.apply(this,arguments))}return Ya(b,a),b}(gb))||ib),sb=(jb=b.messageType(-103),jb(kb=function(a){function b(){return Ba(this,b),Ra(this,a.apply(this,arguments))}return Ya(b,a),b}(gb))||kb),tb=(lb=b.messageType(-104),lb(mb=function(a){function b(){return Ba(this,b),Ra(this,a.apply(this,arguments))}return Ya(b,a),b}(gb))||mb),ub=(nb=b.messageType(-105),nb(ob=function(a){function b(){return Ba(this,b),Ra(this,a.apply(this,arguments))}return Ya(b,a),b}(gb))||ob),vb=function(a){function b(c,d){Ba(this,b);var e=Ra(this,a.call(this));e._setConversation(c),e._peerConnection=e._createPeerConnection(d),e._call=db(),e._promises={};var f=new ta(function(a){e._promises.resolveStreamReady=a}),g=new ta(function(a){e._promises.resolveAccept=a});return ta.all([f,g]).then(function(a){var b=fa(a,1),c=b[0];e._call.can("connect")&&(e._call.connect(),e.emit("connect",c))}),e}return Ya(b,a),b.prototype.close=function(){var a=this;return ta.resolve().then(function(){a._call.close(),a._destroyPeerConnection(),a._peerConnection.close(),a._destroy()})},b.prototype._handleCloseEvent=function(){this._call.can("close")&&(this.close(),this.emit("close"))},b.prototype._setConversation=function(a){this._conversation&&this._conversation.off("message"),a&&(this._conversation=a,a.on("message",this._handleMessage.bind(this)))},b.prototype._destroy=function(){this._conversation.off("message")},b.prototype._createPeerConnection=function(a){var b=new RTCPeerConnection(a);return b.onicecandidate=this._handleICECandidateEvent.bind(this),b.onaddstream=this._handleAddStreamEvent.bind(this),b.onnremovestream=this._handleRemoveStreamEvent.bind(this),b.oniceconnectionstatechange=this._handleICEConnectionStateChangeEvent.bind(this),b.onsignalingstatechange=this._handleSignalingStateChangeEvent.bind(this),b},b.prototype._destroyPeerConnection=function(){var a=this._peerConnection;delete a.onaddstream,delete a.onremovestream,delete a.onnicecandidate,delete a.oniceconnectionstatechange,delete a.onsignalingstatechange},b.prototype._handleMessage=function(a){return a instanceof rb?this._handleAnswer(a):a instanceof tb?this._handleRefusal():a instanceof ub?this._handleCancelation():a instanceof sb&&this._handleICECandidate(a)},b.prototype._handleICECandidate=function(a){var b=new RTCIceCandidate(a.payload);this._peerConnection&&this._peerConnection.addIceCandidate(b).catch(console.error.bind(console))},b.prototype._handleICECandidateEvent=function(a){return!(!a.candidate||!this._conversation)&&this._conversation.send(new sb(a.candidate)).catch(console.error.bind(console))},b.prototype._handleAddStreamEvent=function(a){this._promises.resolveStreamReady(a.stream)},b.prototype._handleRemoveStreamEvent=function(){this._handleCloseEvent()},b.prototype._handleICEConnectionStateChangeEvent=function(){switch(this._peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this._handleCloseEvent()}},b.prototype._handleSignalingStateChangeEvent=function(){switch(this._peerConnection.signalingState){case"closed":this._handleCloseEvent()}},b.prototype._handleAnswer=function(){throw new Error("not implemented")},b.prototype._handleRefusal=function(){throw new Error("not implemented")},b.prototype._handleCancelation=function(){throw new Error("not implemented")},bb(b,[{key:"state",get:function(){return this._call.current}}]),b}(Za),wb=function(a){function b(c,d,e){Ba(this,b);var f=Ra(this,a.call(this,d,e));return f.to=c,f}return Ya(b,a),b.prototype._handleAnswer=function(a){var b=new RTCSessionDescription(a.payload);this._peerConnection.setRemoteDescription(b),this._promises.resolveAccept()},b.prototype._handleRefusal=function(){this._destroyPeerConnection(),this._call.refuse(),this.emit("refuse"),this._destroy()},b.prototype.cancel=function(){var a=this;return this._call.cancel(),this._conversation.send(new ub).then(function(){return a._destroy()})},b.prototype.close=function(){return this._call.can("cancel")?this.cancel():a.prototype.close.call(this)},b}(vb),xb=function(a){function b(c,d,e){Ba(this,b);var f=Ra(this,a.call(this,d,e));f.from=c.from;var g=new RTCSessionDescription(c.payload);return f._handleOfferPromise=f._peerConnection.setRemoteDescription(g),f}return Ya(b,a),b.prototype.accept=function(a){var b=this;if(!a)throw new TypeError("a MediaStream instance is required to accept a call");return this._handleOfferPromise.then(function(){return b._peerConnection.addStream(a)}).then(function(){return b._peerConnection.createAnswer()}).then(function(a){return b._peerConnection.setLocalDescription(a)}).then(function(){return b._conversation.send(new rb(b._peerConnection.localDescription))}).then(function(){return b._promises.resolveAccept()})},b.prototype.refuse=function(){var a=this;return this._conversation.send(new tb).then(function(){a._call.refuse(),a._destroy()})},b.prototype._handleCancelation=function(){this._call.cancel(),this.emit("cancel"),this._destroy()},b}(vb),yb=(pb=b.messageType(-101),pb(qb=function(a){function b(){return Ba(this,b),Ra(this,a.apply(this,arguments))}return Ya(b,a),b}(gb))||qb),zb={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.ekiga.net","stun:stun.ideasip.com","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stun.stunprotocol.org:3478","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org"]}]},Ab=function(a){function b(c,d){if(Ba(this,b),"string"!=typeof c)throw new TypeError("id is not a string");var e=Ra(this,a.call(this));return e.id=c,e.options=za({RTCConfiguration:zb},d),e}return Ya(b,a),b.prototype._open=function(a,b){var c=this;return a.createIMClient(this.id,b,"webrtc").then(function(a){return c._imClient=a,c.id=a.id,a.on("message",function(a,b){return a instanceof yb&&c._handleOffer(a,b)}),a.on("conflict",function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c.emit.apply(c,["conflict"].concat(b))}),c})},b.prototype.close=function(){return this._imClient.close()},b.prototype.call=function(a,b){var c=this;if("string"!=typeof a)throw new TypeError("target id is not a string");if(!b)throw new TypeError("a MediaStream instance is required to make a call");return this._imClient.ping([a]).then(function(d){if(!d.length)throw new Error("Call failed as "+a+" is not online");var e=new wb(a,null,c.options.RTCConfiguration),f=new ta(function(a){e._peerConnection.onnegotiationneeded=a});return e._peerConnection.addStream(b),f.then(function(){return ta.all([c._imClient.createConversation({members:[a],unique:!0}),e._peerConnection.createOffer().then(function(a){e._peerConnection.setLocalDescription(a)})])}).then(function(a){var b=fa(a,1),c=b[0];return e._setConversation(c),c.send(new yb(e._peerConnection.localDescription))}).then(function(){return e})})},b.prototype._handleOffer=function(a,b){var c=new xb(a,b,this.options.RTCConfiguration);this.emit("call",c)},b}(Za),Bb="leancloud-realtime-plugin-webrtc",Cb=[yb,rb,sb,tb,ub],Db=function(a){a.createWebRTCClient=function(b,c){return new Ab(b)._open(a,c)}},Eb={name:Bb,messageClasses:Cb,onRealtimeCreate:Db},Fb=!!(window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate);a.WebRTCPlugin=Eb,a.isWebRTCSupported=Fb,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=webrtc.min.js.map